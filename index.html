<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Hydrostatic Test Form - A-1 Affordable Plumbing Services</title>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    body {
      font-family: 'Arial', sans-serif;
      background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
      min-height: 100vh;
      padding: 20px;
    }
    .form-container {
      max-width: 900px;
      margin: 0 auto;
      background: white;
      border-radius: 15px;
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
      overflow: hidden;
    }
    .header {
      background: linear-gradient(135deg, #1e3a8a 0%, #3b82f6 100%);
      color: white;
      padding: 30px;
      text-align: center;
    }
    .header h1 {
      font-size: 2.5em;
      margin-bottom: 10px;
      font-weight: bold;
    }
    .header .phone {
      font-size: 1.2em;
      margin-bottom: 5px;
    }
    .header .contact-info {
      font-size: 0.9em;
      opacity: 0.9;
    }
    .form-content {
      padding: 30px;
    }
    .form-section {
      margin-bottom: 25px;
      padding: 20px;
      border: 2px solid #e1e8ed;
      border-radius: 10px;
      background: #fafbfc;
    }
    .section-title {
      font-size: 1.2em;
      font-weight: bold;
      color: #333;
      margin-bottom: 15px;
      text-transform: uppercase;
      letter-spacing: 1px;
      border-bottom: 2px solid #3b82f6;
      padding-bottom: 8px;
    }
    .form-row {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
      margin-bottom: 15px;
    }
    .form-row.two-col {
      grid-template-columns: 1fr 1fr;
    }
    .form-row.three-col {
      grid-template-columns: 1fr 1fr 1fr;
    }
    .form-row.four-col {
      grid-template-columns: 1fr 1fr 1fr 1fr;
    }
    .form-group {}
    .form-group.full-width {
      grid-column: 1 / -1;
    }
    label {
      display: block;
      margin-bottom: 5px;
      font-weight: bold;
      color: #555;
      font-size: 0.9em;
    }
    input[type="text"],
    input[type="date"],
    input[type="number"],
    select,
    textarea {
      width: 100%;
      padding: 8px;
      border: 2px solid #ddd;
      border-radius: 6px;
      font-size: 14px;
    }
    textarea {
      resize: vertical;
      min-height: 60px;
    }
    .checkbox-group,
    .radio-group {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 10px;
      margin-top: 10px;
    }
    .checkbox-item,
    .radio-item {
      display: flex;
      align-items: center;
      gap: 8px;
    }
    input[type="checkbox"],
    input[type="radio"] {
      width: auto;
      margin: 0;
    }
    .signature-section {
      background: #f8f9fa;
      border: 2px dashed #3b82f6;
      padding: 25px;
      text-align: center;
      border-radius: 10px;
    }
    .signature-line {
      border-bottom: 2px solid #333;
      width: 300px;
      margin: 15px auto;
      height: 30px;
    }
    .date-signature {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
      margin-top: 20px;
      max-width: 500px;
      margin-left: auto;
      margin-right: auto;
    }
    .btn-container {
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
      gap: 15px;
      margin-top: 30px;
    }
    .btn {
      color: white;
      padding: 12px 20px;
      border: none;
      border-radius: 25px;
      font-size: 14px;
      font-weight: bold;
      cursor: pointer;
      min-width: 120px;
      transition: transform 0.2s;
    }
    .btn:hover {
      transform: translateY(-2px);
    }
    .btn-submit {
      background: linear-gradient(135deg, #059669 0%, #10b981 100%);
    }
    .btn-print {
      background: linear-gradient(135deg, #1e3a8a 0%, #3b82f6 100%);
    }
    .btn-clear {
      background: linear-gradient(135deg, #dc2626 0%, #ef4444 100%);
    }
    .btn-share {
      background: linear-gradient(135deg, #7c3aed 0%, #8b5cf6 100%);
    }
    .modal {
      display: none;
      position: fixed;
      z-index: 1000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.5);
    }
    .modal-content {
      background-color: white;
      margin: 15% auto;
      padding: 30px;
      border-radius: 15px;
      width: 90%;
      max-width: 500px;
      text-align: center;
    }
    .close {
      color: #aaa;
      float: right;
      font-size: 28px;
      font-weight: bold;
      cursor: pointer;
    }
    .close:hover {
      color: black;
    }
    .share-options {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
      gap: 15px;
      margin-top: 20px;
    }
    .share-btn {
      padding: 15px;
      border: 2px solid #ddd;
      border-radius: 10px;
      background: white;
      cursor: pointer;
      transition: all 0.3s;
    }
    .share-btn:hover {
      border-color: #3b82f6;
      background: #f0f9ff;
    }
    @media print {
      body {
        background: white !important;
        padding: 0;
        margin: 0;
        font-size: 10pt;
        line-height: 1.2;
      }
      .form-container {
        box-shadow: none !important;
        border-radius: 0 !important;
        max-width: 100% !important;
        margin: 0 !important;
        padding: 0 !important;
      }
      .header {
        background: none !important;
        color: black !important;
        text-align: center;
        padding: 10px !important;
        border-bottom: 2px solid #000;
      }
      .header h1 {
        font-size: 18pt !important;
      }
      .header .phone,
      .header .contact-info {
        font-size: 10pt !important;
      }
      .form-content {
        padding: 15px !important;
      }
      .btn-container,
      .btn,
      #formMessage,
      .modal {
        display: none !important;
      }
      input,
      select,
      textarea {
        border: none !important;
        background: none !important;
        box-shadow: none !important;
        font-size: 10pt !important;
        padding: 2px !important;
      }
      .form-section {
        border: 1px solid #ccc !important;
        background: none !important;
        padding: 10px !important;
        margin-bottom: 15px !important;
        page-break-inside: avoid;
      }
      .section-title {
        font-size: 12pt !important;
        border-bottom: 1px solid #000 !important;
        margin-bottom: 8px !important;
        padding-bottom: 4px !important;
      }
      .form-row {
        gap: 10px !important;
        margin-bottom: 8px !important;
      }
      .signature-line {
        border-bottom: 2px solid #000 !important;
        height: 30px;
        margin: 10px auto;
      }
      .checkbox-group,
      .radio-group {
        gap: 5px !important;
      }
      .checkbox-item,
      .radio-item {
        font-size: 9pt !important;
      }
      label {
        font-size: 9pt !important;
        margin-bottom: 2px !important;
      }
    }
    @media (max-width: 768px) {
      .form-row {
        grid-template-columns: 1fr !important;
      }
      .form-content {
        padding: 20px;
      }
      .header {
        padding: 20px;
      }
      .header h1 {
        font-size: 2em;
      }
    }
  </style>
</head>

<body>
  <div class="form-container">
    <div class="header">
      <h1>A-1 Affordable Plumbing</h1>
      <div class="phone">469-900-5194</div>
      <div class="contact-info">
        Chris Crabtree M-43801<br />
        320 McMillen Rd., Lucas, TX 75002
      </div>
    </div>

    <div class="form-content">
      <form id="hydrostaticTestForm">
        <!-- Basic Information -->
        <div class="form-section">
          <div class="section-title">Basic Information</div>
          <div class="form-row two-col">
            <div class="form-group">
              <label for="customerName">Name:</label>
              <input type="text" id="customerName" name="customerName" required />
            </div>
            <div class="form-group">
              <label for="testDate">Test Date:</label>
              <input type="date" id="testDate" name="testDate" required />
            </div>
          </div>
          <div class="form-row two-col">
            <div class="form-group">
              <label for="street">Street:</label>
              <input type="text" id="street" name="street" required />
            </div>
            <div class="form-group">
              <label for="cityZip">City/Zip:</label>
              <input type="text" id="cityZip" name="cityZip" required />
            </div>
          </div>
          <div class="form-row two-col">
            <div class="form-group">
              <label for="preTest">Pre-Test:</label>
              <textarea id="preTest" name="preTest"></textarea>
            </div>
            <div class="form-group">
              <label for="postTest">Post-Test:</label>
              <textarea id="postTest" name="postTest"></textarea>
            </div>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label for="masterPlumber">Master Plumber:</label>
              <input type="text" id="masterPlumber" name="masterPlumber" value="Chris Crabtree M-43801" />
            </div>
          </div>
        </div>
        <!-- Foundation Type -->
        <div class="form-section">
          <div class="section-title">Foundation Type</div>
          <div class="radio-group">
            <div class="radio-item">
              <input type="radio" id="pierBeam" name="foundationType" value="pier_beam" />
              <label for="pierBeam">PIER AND BEAM</label>
            </div>
            <div class="radio-item">
              <input type="radio" id="slab" name="foundationType" value="slab" />
              <label for="slab">SLAB</label>
            </div>
          </div>
        </div>
        <!-- Test Performed -->
        <div class="form-section">
          <div class="section-title">Test Performed</div>
          <div class="checkbox-group">
            <div class="checkbox-item">
              <input type="checkbox" id="domesticWater" name="testsPerformed" value="domestic_water" />
              <label for="domesticWater">Domestic Water</label>
            </div>
            <div class="checkbox-item">
              <input type="checkbox" id="waterLeakIsolation" name="testsPerformed" value="water_leak_isolation" />
              <label for="waterLeakIsolation">Water Leak Isolation</label>
            </div>
            <div class="checkbox-item">
              <input type="checkbox" id="staticHeadSewer" name="testsPerformed" value="static_head_sewer" />
              <label for="staticHeadSewer">Static Head Sewer Test</label>
            </div>
            <div class="checkbox-item">
              <input type="checkbox" id="measureVolFlow" name="testsPerformed" value="measure_vol_flow" />
              <label for="measureVolFlow">Measure Vol Flow</label>
            </div>
            <div class="checkbox-item">
              <input type="checkbox" id="sewerLeakIsolation" name="testsPerformed" value="sewer_leak_isolation" />
              <label for="sewerLeakIsolation">Sewer Leak Isolation</label>
            </div>
            <div class="checkbox-item">
              <input type="checkbox" id="showerPanTest" name="testsPerformed" value="shower_pan_test" />
              <label for="showerPanTest">Shower Pan Test</label>
            </div>
          </div>
        </div>
        <!-- Plumbing Type -->
        <div class="form-section">
          <div class="section-title">Plumbing Type</div>
          <div class="form-row">
            <div class="form-group">
              <label>WATER:</label>
              <div class="checkbox-group">
                <div class="checkbox-item">
                  <input type="checkbox" id="copper" name="waterType" value="copper" />
                  <label for="copper">COPPER</label>
                </div>
                <div class="checkbox-item">
                  <input type="checkbox" id="galvanized" name="waterType" value="galvanized" />
                  <label for="galvanized">GALVANIZED</label>
                </div>
                <div class="checkbox-item">
                  <input type="checkbox" id="quest" name="waterType" value="quest" />
                  <label for="quest">QUEST</label>
                </div>
              </div>
            </div>
            <div class="form-group">
              <label>SEWER:</label>
              <div class="checkbox-group">
                <div class="checkbox-item">
                  <input type="checkbox" id="pvc" name="sewerType" value="pvc" />
                  <label for="pvc">PVC</label>
                </div>
                <div class="checkbox-item">
                  <input type="checkbox" id="castIron" name="sewerType" value="cast_iron" />
                  <label for="castIron">CAST IRON</label>
                </div>
                <div class="checkbox-item">
                  <input type="checkbox" id="abs" name="sewerType" value="abs" />
                  <label for="abs">ABS</label>
                </div>
              </div>
            </div>
          </div>
        </div>
        <!-- Domestic Water Test -->
        <div class="form-section">
          <div class="section-title">Domestic Water Test</div>
          <div class="form-row three-col">
            <div class="form-group">
              <label for="beginningPressure">Beginning Pressure (PSI):</label>
              <input type="number" id="beginningPressure" name="beginningPressure" step="0.1" />
            </div>
            <div class="form-group">
              <label for="endingPressure">Ending Pressure (PSI):</label>
              <input type="number" id="endingPressure" name="endingPressure" step="0.1" />
            </div>
            <div class="form-group">
              <label for="pressureLoss">Loss (PSI):</label>
              <input type="number" id="pressureLoss" name="pressureLoss" step="0.1" readonly />
            </div>
          </div>
          <div class="form-row two-col">
            <div class="form-group">
              <label for="testLength">Length of Test:</label>
              <input type="text" id="testLength" name="testLength" />
            </div>
            <div class="form-group">
              <label for="shutOffLocation">Shut Off Location:</label>
              <input type="text" id="shutOffLocation" name="shutOffLocation" />
            </div>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label>Hydrostatic Test Results:</label>
              <div class="radio-group">
                <div class="radio-item">
                  <input type="radio" id="hydroPassed" name="hydrostaticResults" value="passed" />
                  <label for="hydroPassed">PASSED</label>
                </div>
                <div class="radio-item">
                  <input type="radio" id="hydroFailed" name="hydrostaticResults" value="failed" />
                  <label for="hydroFailed">FAILED</label>
                </div>
              </div>
            </div>
          </div>
        </div>
        <!-- Static Head Sewer Test -->
        <div class="form-section">
          <div class="section-title">Static Head Sewer Test</div>
          <div class="form-row">
            <div class="form-group">
              <label>Clean Out Location:</label>
              <div class="checkbox-group">
                <div class="checkbox-item">
                  <input type="checkbox" id="front" name="cleanOutLocation" value="front" />
                  <label for="front">Front</label>
                </div>
                <div class="checkbox-item">
                  <input type="checkbox" id="back" name="cleanOutLocation" value="back" />
                  <label for="back">Back</label>
                </div>
                <div class="checkbox-item">
                  <input type="checkbox" id="left" name="cleanOutLocation" value="left" />
                  <label for="left">Left</label>
                </div>
                <div class="checkbox-item">
                  <input type="checkbox" id="right" name="cleanOutLocation" value="right" />
                  <label for="right">Right</label>
                </div>
              </div>
            </div>
          </div>
          <div class="form-row two-col">
            <div class="form-group">
              <label for="sewerTestLength">Length of Test:</label>
              <input type="text" id="sewerTestLength" name="sewerTestLength" />
            </div>
            <div class="form-group">
              <label>Loss of Flow:</label>
              <div class="radio-group">
                <div class="radio-item">
                  <input type="radio" id="sysHeld" name="lossOfFlow" value="sys_held" />
                  <label for="sysHeld">Sys Held</label>
                </div>
                <div class="radio-item">
                  <input type="radio" id="sysFailed" name="lossOfFlow" value="sys_failed" />
                  <label for="sysFailed">Sys Failed</label>
                </div>
              </div>
            </div>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label>Static Head Test on Sewer System Results:</label>
              <div class="radio-group">
                <div class="radio-item">
                  <input type="radio" id="sewerPassed" name="sewerTestResults" value="passed" />
                  <label for="sewerPassed">PASSED</label>
                </div>
                <div class="radio-item">
                  <input type="radio" id="sewerFailed" name="sewerTestResults" value="failed" />
                  <label for="sewerFailed">FAILED</label>
                </div>
              </div>
            </div>
          </div>
        </div>
        <!-- Signature -->
        <div class="form-section signature-section">
          <div class="section-title">Signature</div>
          <div class="signature-line"></div>
          <div class="date-signature">
            <div class="form-group">
              <label for="technicianName">Technician Name/Signature:</label>
              <input type="text" id="technicianName" name="technicianName" value="Chris Crabtree" />
            </div>
            <div class="form-group">
              <label for="signatureDate">Date:</label>
              <input type="date" id="signatureDate" name="signatureDate" />
            </div>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label for="licenseNumber">License Number:</label>
              <input type="text" id="licenseNumber" name="licenseNumber" value="M-43801" readonly />
            </div>
          </div>
        </div>
        <div class="btn-container">
          <button type="button" class="btn btn-submit" id="submitBtn">Submit to Supabase</button>
          <button type="button" class="btn btn-print" onclick="printForm()">Print Form</button>
          <button type="button" class="btn btn-clear" onclick="clearForm()">Clear Form</button>
          <button type="button" class="btn btn-share" onclick="openShareModal()">Share Form</button>
        </div>
      </form>
    </div>
  </div>
  <div id="shareModal" class="modal">
    <div class="modal-content">
      <span class="close" onclick="closeShareModal()">&times;</span>
      <h2>Share Completed Form</h2>
      <p>Choose how you'd like to share this form:</p>
      <div class="share-options">
        <div class="share-btn" onclick="shareViaEmail()">
          <div>📧</div>
          <div>Email</div>
        </div>
        <div class="share-btn" onclick="shareViaSMS()">
          <div>📱</div>
          <div>Text/SMS</div>
        </div>
        <div class="share-btn" onclick="shareViaWeb()">
          <div>🌐</div>
          <div>Web Share</div>
        </div>
        <div class="share-btn" onclick="copyFormData()">
          <div>📋</div>
          <div>Copy Data</div>
        </div>
        <div class="share-btn" onclick="generatePDF()">
          <div>📄</div>
          <div>Generate PDF</div>
        </div>
      </div>
    </div>
  </div>
  <div id="formMessage" style="display:none; text-align:center; padding: 15px; margin-top: 20px; border-radius: 8px;">
  </div>
  <script>
    // --- FORM SUBMISSION LOGIC & SUPABASE ---
    window.addEventListener('DOMContentLoaded', () => {
      document.getElementById('beginningPressure').addEventListener('input', calculatePressureLoss);
      document.getElementById('endingPressure').addEventListener('input', calculatePressureLoss);
      const today = new Date().toISOString().split('T')[0];
      document.getElementById('testDate').value = today;
      document.getElementById('signatureDate').value = today;

      // --- SUPABASE LOGIC ---
      const supabase = window.supabase.createClient(
        'https://zzigzylypifjokskehkn.supabase.co',
        'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inp6aWd6eWx5cGlmam9rc2tlaGtuIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTIyODEzNDAsImV4cCI6MjA2Nzg1NzM0MH0.UjSODSs-tWPmXxKkyuaSIvSutx5dCnJsMhzslbFaBUg'
      );

      document.getElementById('submitBtn').addEventListener('click', async (e) => {
        e.preventDefault();
        const payload = {
          customer_name: document.getElementById('customerName').value,
          test_date: document.getElementById('testDate').value,
          technician_name: document.getElementById('technicianName').value,
          test_location: document.getElementById('street').value + ', ' + document.getElementById('cityZip').value,
          // Add additional fields here if you want to send them to Supabase!
        };
        const { error } = await supabase.from('hydrostatic_tests').insert([payload]);
        if (error) alert('Error: ' + error.message);
        else alert('Submitted!');
      });
    });

    // --- UTILITY & UI FUNCTIONS (unchanged) ---
    function calculatePressureLoss() {
      const beginning = parseFloat(document.getElementById('beginningPressure').value) || 0;
      const ending = parseFloat(document.getElementById('endingPressure').value) || 0;
      const loss = beginning - ending;
      document.getElementById('pressureLoss').value = loss >= 0 ? loss.toFixed(1) : '';
    }
    function printForm() { window.print(); }
    function clearForm() {
      if (confirm("Are you sure you want to clear the form?")) {
        document.getElementById('hydrostaticTestForm').reset();
        document.getElementById('pressureLoss').value = '';
        document.getElementById('formMessage').style.display = 'none';
      }
    }
    function openShareModal() { document.getElementById('shareModal').style.display = 'block'; }
    function closeShareModal() { document.getElementById('shareModal').style.display = 'none'; }
    function shareViaEmail() {
      const formData = getFormDataText();
      const subject = encodeURIComponent('Hydrostatic Test Form - A-1 Affordable Plumbing');
      const body = encodeURIComponent(`Hydrostatic Test Form Results:\n\n${formData}`);
      window.location.href = `mailto:?subject=${subject}&body=${body}`;
      closeShareModal();
    }
    function shareViaSMS() {
      const formData = getFormDataText();
      const message = encodeURIComponent(`A-1 Plumbing Test Results: ${formData.substring(0, 300)}...`);
      window.location.href = `sms:?body=${message}`;
      closeShareModal();
    }
    async function shareViaWeb() {
      if (navigator.share) {
        try {
          await navigator.share({
            title: 'Hydrostatic Test Form - A-1 Affordable Plumbing',
            text: getFormDataText(),
            url: window.location.href
          });
          closeShareModal();
        } catch (err) {
          console.log('Error sharing:', err);
          copyFormData(); // Fallback to copy
        }
      } else {
        alert('Web sharing not supported on this device. Data copied to clipboard instead.');
        copyFormData();
      }
    }
    async function copyFormData() {
      try {
        await navigator.clipboard.writeText(getFormDataText());
        alert('Form data copied to clipboard!');
        closeShareModal();
      } catch (err) {
        console.log('Failed to copy:', err);
        const textArea = document.createElement('textarea');
        textArea.value = getFormDataText();
        document.body.appendChild(textArea);
        textArea.select();
        document.execCommand('copy');
        document.body.removeChild(textArea);
        alert('Form data copied to clipboard!');
        closeShareModal();
      }
    }
    function generatePDF() {
      closeShareModal();
      setTimeout(() => { window.print(); }, 100);
    }
    function getFormDataText() {
      const form = document.getElementById('hydrostaticTestForm');
      const formData = new FormData(form);
      let result = 'HYDROSTATIC TEST FORM - A-1 AFFORDABLE PLUMBING\n';
      result += '='.repeat(50) + '\n\n';
      result += 'BASIC INFORMATION:\n';
      result += `Name: ${formData.get('customerName') || 'N/A'}\n`;
      result += `Test Date: ${formData.get('testDate') || 'N/A'}\n`;
      result += `Address: ${formData.get('street') || 'N/A'}, ${formData.get('cityZip') || 'N/A'}\n\n`;
      result += 'DOMESTIC WATER TEST:\n';
      result += `Results: ${formData.get('hydrostaticResults') || 'N/A'}\n\n`;
      result += 'TECHNICIAN:\n';
      result += `${formData.get('technicianName') || 'N/A'}\n`;
      return result;
    }
    window.onclick = function (event) {
      const modal = document.getElementById('shareModal');
      if (event.target === modal) { closeShareModal(); }
    }
  </script>
</body>
</html>
